<!DOCTYPE html>
<html>
<head>
    <title>YT-DLP Downloader</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
    <h1>YT-DLP Downloader</h1>
    <div id="user-info">
        <a href="/login" id="login-link">Login</a>
        <span id="username" style="display: none;">
            <a href="#" id="username-link"></a>
            <div id="user-menu" style="display: none;">
                <a href="#">Settings</a>
                <a href="/logout" id="logout-link">Logout</a>
            </div>
        </span>
    </div>

    <form id="download-form">
        <div>
            <label for="url">Enter Video URL(s):</label><br>
            <textarea id="url" name="url" rows="10" cols="50" placeholder="Enter one URL per line"></textarea>
        </div>
        <div>
            <label for="args">Custom Arguments:</label><br>
            <input type="text" id="args" name="args" placeholder="Enter optional arguments">
        </div>
        <div>
            <label for="cutout">Timestamped Cutout (start-end):</label><br>
            <input type="text" id="cutout" name="cutout" placeholder="Enter start & end times for cutout">
        </div>
        <div>
            <label for="output">Output File Name:</label><br>
            <input type="text" id="output" name="output" placeholder="Enter optional filename">
        </div>
        <div>
            <button type="submit">Download</button>
        </div>
    </form>
    <div id="status"></div>
    <script>
    $(document).ready(function(){
        $("#download-form").on('submit', function(event){
            event.preventDefault();
            $("#status").html("Download started...");
            $.post("/download", $(this).serialize(), function(data){
                $("#status").html(data);
            });
        });
    });
    </script>

    <script>
    $(document).ready(function(){
        // Check if the user is logged in
        if (sessionStorage.getItem('username')) {
            // If the user is logged in, hide the login link and show the username and user menu
            $('#login-link').hide();
            $('#username-link').text(sessionStorage.getItem('username'));
            $('#username').show();
        }

        // Show the user menu when the username is clicked
        $('#username-link').click(function(event){
            event.preventDefault();
            $('#user-menu').toggle();
        });

        // Handle the login form submission
        $('#login-form').submit(function(event){
            event.preventDefault();
            $.post("/login", $(this).serialize(), function(data){
                // If the login is successful, store the username in sessionStorage, hide the login link, and show the username and user menu
                sessionStorage.setItem('username', $('#username-input').val());
                $('#login-link').hide();
                $('#username-link').text(sessionStorage.getItem('username'));
                $('#username').show();
            });
        });

        // Handle the logout link click
        $('#logout-link').click(function(event){
            event.preventDefault();
            $.post("/logout", function(data){
                // If the logout is successful, remove the username from sessionStorage, hide the username and user menu, and show the login link
                sessionStorage.removeItem('username');
                $('#username').hide();
                $('#user-menu').hide();
                $('#login-link').show();
            });
        });
</body>
</html>
